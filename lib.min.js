var token,pid,myPokemon,SERVICE_URL="https://webster.cs.washington.edu/pokedex-2/18sp/";function $(e){return document.getElementById(e)}function $$(e){var t=document.querySelectorAll(e);return 1==t.length?t[0]:t}function hide(e){if(e instanceof Array)for(var t=0;t<e.length;t++)e[t].classList.add("hidden");else e.classList.add("hidden")}function show(e){if(e instanceof Array)for(var t=0;t<e.length;t++)e[t].classList.remove("hidden");else e.classList.remove("hidden")}function toggleDisplay(e){if(e instanceof Array)for(var t=0;t<e.length;t++)e[t].classList.toggle("hidden");else e.classList.toggle("hidden")}function gen(e,t){var n=document.createElement(e);if(t&&""!=t)if(t instanceof Array)for(var o=0;o<t.length;o++)n.classList.add(t[o]);else n.classList.add(t);return n}function genText(e,t){var n=document.createElement(e);return n.innerText=t,n}function appendChildren(e,t){for(var n=0;n<t.length;n++)e.appendChild(t[n]);return e}function escSpChar(e){for(var t=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","`","{","|","}","~"," "],n=0;n<e.length;n++)t.includes(e.charAt(n))&&(e=e.slice(0,n)+"\\"+e.slice(n),n+=1);return e}function getRequest(e,t,n){let o={};e.indexOf("webster.cs.washington.edu")<0&&(o.credentials="include"),fetch(e+t,o).then(checkStatus).then(n).catch(console.log)}function postRequest(e,t,n){let o={method:"POST",body:t};e.indexOf("webster.cs.washington.edu")<0&&(o.credentials="include"),fetch(e,o).then(checkStatus).then(n).catch(console.log)}function handleGetCreds(e){let t=e.split("\n");t.length<2?console.log("Error: getcreds.php does not output pid and token on separate lines."):(pid=t[0],token=t[1],console.log("getcreds.php call finished. pid: "+pid+", token: "+token))}function fetchPid(){pid&&token||(console.log("Calling getcreds.php..."),getRequest("getcreds.php","",handleGetCreds))}function restartMyDex(){let e=new FormData;e.append("mode","removeall"),console.log("Calling delete.php with mode=removeall..."),postRequest("delete.php",e,function(e){console.log("delete.php finished with mode=removeall"),console.log("The following pokedex should be empty:"),fetchMyPokemon()})}function getDex(e,t,n){let o=new FormData;o.append("pid",e),o.append("token",t),n&&o.append("force","true"),postRequest(SERVICE_URL+"restart.php",o,function(e){let t=JSON.parse(e);if(t.length>1)for(i in restartMyDex(),t)addPokemon(t[i])})}function removeFromPokedex(e){var t=new FormData;t.append("name",e),console.log("Calling delete.php with name="+e+"..."),postRequest("delete.php",t,function(t){$(e).classList.add("unfound"),$(e).onclick="",console.log("delete.php with name="+e+" returned:"),console.log(JSON.parse(t)),fetchMyPokemon()})}function fetchMyPokemon(){console.log("Calling select.php..."),getRequest("select.php","",function(e){myPokemon=JSON.parse(e),console.log("select.php returned: "),console.log(myPokemon)})}function addPokemon(e){var t=new FormData;t.append("name",e),console.log("Calling insert.php with name="+e+"..."),postRequest("insert.php",t,function(){console.log("insert.php finished."),fetchMyPokemon()})}function logStudentTestCall(e){console.log("Finished call to trade.php. Response: ");let t=JSON.parse(e);console.log(t)}function creds(){return"?pid="+pid+"&token="+token}function checkStatus(e){return e.status>=200&&e.status<300||0==e.status?e.text():Promise.reject(new Error(e.status+": "+e.statusText))}
